services:
  stirling-pdf:
    image: stirlingtools/stirling-pdf:latest
    container_name: stirling_pdf
    environment:
      - SYSTEM_DEFAULTLOCALE=de-DE
      - SECURITY_ENABLELOGIN=false
      - SYSTEM_GOOGLEVISIBILITY=false
      - SYSTEM_CONNECTIONTIMEOUTMINUTES=5
      - SERVER_FORWARD_HEADERS_STRATEGY=NATIVE

    volumes:
      - ./stirling-data/tessdata:/usr/share/tessdata
      - ./stirling-data/configs:/configs
      - ./stirling-data/logs:/logs
      - ./stirling-data/customFiles:/customFiles:rw

    networks:
      - frontend

    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.stirling.rule=Host(`pdf.lr-projects.de`)"
      - "traefik.http.routers.stirling.entrypoints=websecure"
      - "traefik.http.routers.stirling.tls=true"
      - "traefik.http.routers.stirling.tls.certresolver=cloudflare"
      - "traefik.http.services.stirling.loadbalancer.server.port=8080"
      - "traefik.docker.network=frontend"

    restart: unless-stopped
    
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '2.0'
        reservations:
          memory: 1G

networks:
  frontend:
    external: true